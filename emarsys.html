<!DOCTYPE html>
<html lang="en" style="width:100%;height: 100%;">
<head>
                <meta charset=" UTF-8">
                <title>Emarsys</title>
				
<script>

var session_id = localStorage.getItem('session_id');
var emarsysHost = localStorage.getItem('emarsysHost');
var emarsysurl = localStorage.getItem('emarsysurl');

function onLoad(){
	document.getElementById("url").value= emarsysurl;
}

function saveEmarsysUrl() {
  
	emarsysurl = document.getElementById("url").value

	try {
	  emarsysHost = new URL(emarsysurl).hostname;
	  
	} catch (error) {
	  alert(error);
	}

  
	var urlParams = new URLSearchParams(emarsysurl);
	session_id = urlParams.get("session_id")
  
	if (session_id === null){
		alert ("Invalid url")
	}
  
  localStorage.setItem('emarsysurl', emarsysurl);
  localStorage.setItem('session_id', session_id);
  localStorage.setItem('emarsysHost', emarsysHost);
  
}

function openEmarsysPopup(){
	if (session_id !== null && emarsysHost!== null){
		searchUrl = emarsysHost + "/bootstrap.php?session_id="+ session_id;
		alert (searchUrl);
		location.href = 'https://code.tutsplus.com';
		//window.open(searchUrl, "left=100,top=100,width=600,height=800");
	}
}

//https://demo.emarsys.net/userprofiles.php?session_id=57c4GkH8rhM983033331&action=searchnlist&search=vikas&profile=&
//https://demo.emarsys.net/userprofiles.php?session_id=57c4GkH8rhM983033331&elements=1&qs=email%3Dmarkku*
//https://demo.emarsys.net/userprofiles.php?session_id=57c4GkH8rhM983033331&action=searchnlist&search=vikas&profile=&
//https://demo.emarsys.net/bootstrap.php?r=customer/Login/Relogin&uri=%2Fbootstrap.php%3Fr%3Dhome%26startpage%3D1%26session_id%3D
//https://demo.emarsys.net/bootstrap.php?r=home&startpage=1&session_id=1ea1jdhL2DGB84216943 

</script>
</head>
<body style="margin: 0;width:100%;height: 100%" onload="onLoad()">
<!-- Below Iframe is loaded inside the extension area, that loads the webpage from www.fonecta.fi -->
<!--iframe id="frame" style="border: 0;width: 100%;height: 100%" src="https://demo.emarsys.net/"></iframe-->

<div>
Login to Emarsys: <input type="text" id="url" name="url" size="100"> <button onclick="saveEmarsysUrl()" >Save me</button>
</div>
<!-- Below script gets the call data, finds the caller phone number (originator) and updates the Iframe url with the new url to fonecta with search query string.-->
<script>
			
			var _onMessage = function(oEvent) {
				if (oEvent.data.type === "response" && oEvent.data.payload.result !== "error") {
					var data = oEvent.data.payload.value;
					if (data.channel_type === "phone" && data.originator){
						//alert(data.originator);
						
						//document.getElementById("frame").setAttribute("src", "https://demo.emarsys.net/haku/" + data.originator)
					//	document.getElementById("frame").src = "https://www.fonecta.fi/haku/" + data.originator;
					}
				}
			}

			window.addEventListener("message", _onMessage);
			window.parent.postMessage({type: "init", payload: false, id: "fn-1"}, "*");

</script>
<br>
<button onclick="openEmarsysPopup()" >Open Emarsys</button>
</body>
</html>
