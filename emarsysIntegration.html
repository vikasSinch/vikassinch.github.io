<!DOCTYPE html>
<html lang="en" style="width:100%;height: 100%;">
   <head>
      <meta charset=" UTF-8">
      <title>Emarsys Campaign</title>
       <style>
       table {
         border-collapse: collapse;
         width: 100%;
       }
       th, td {
         border: none;
         padding: 8px;
         text-align: left;
         font-family: Arial, Helvetica, sans-serif;
          font-size: 14px;
         }
       .grey-shade {
         color: #888888;
       }
     </style>
   </head>
      <body style="margin: 0;width:100%;height: 100%">
       <table id="dataTable"></table>


<script>
  var Interaction;
  var _onMessage = function(oEvent) {
     if (oEvent.data.type === "response" && oEvent.data.payload.result !== "error") {
      var data = oEvent.data.payload.value;
         if (data.originator)
          //  alert(JSON.stringify(data.attached_data))
           parseAndPopulateTable(data.attached_data);
         Interaction = data;
         }
  }
  window.addEventListener("message", _onMessage);
  window.parent.postMessage({type: "init", payload: false, id: "fn-1"}, "*");

function createTableRow(key, value) {
    const tr = document.createElement("tr");
    const td = document.createElement("td");
    if (key === null) {
        td.innerHTML = `${value}`;
    } else {
        td.innerHTML = `<span class="grey-shade">${key}</span><br>${value}`;
    }
    tr.appendChild(td);
    return tr;
}

function createHR() {
    const tr = document.createElement("tr");
    const td = document.createElement("td");
    const hr = document.createElement('hr');
    td.appendChild(hr);
    tr.appendChild(td);
    document.getElementById("dataTable").appendChild(tr);
}


function createHeader(header) {
    const tr = document.createElement('tr');
    const th = document.createElement('th');
    th.textContent = header;
    tr.appendChild(th);
    document.getElementById("dataTable").appendChild(tr);
}

function parseAndPopulateTable(contactData) {
    const table = document.getElementById("dataTable");
    createHeader("Customer Details");
    const emarsysData = contactData.customFields.EmarsysContactData;

    for (const key in emarsysData) {
        if (emarsysData.hasOwnProperty(key)) {
            const value = emarsysData[key];
            if (key !== "id" && key !== "uid" && value !== null) {
                const row = createTableRow(key, value);
                table.appendChild(row);
            }
        }
    }
    createHR();
    const campaignData = contactData.customFields.SinchCampaignData;
    if (campaignData !== undefined && campaignData !== null && campaignData !== "") {
        createHeader("Campaign Details");
        for (const field of campaignData.fields.item) {
            if (field !== null || field !== "") {
                const row = createTableRow(null, field);
                table.appendChild(row);
            }
        }
    }
}
</script>        
</body>
</html>
