<!DOCTYPE html>
<html lang="en" style="width:100%;height: 100%;">
   <head>
      <meta charset=" UTF-8">
      <title>Emarsys Campaign</title>
       <style>
       table {
         border-collapse: collapse;
         width: 100%;
       }
       th, td {
         border: none;
         padding: 8px;
         text-align: left;
         font-family: Arial, Helvetica, sans-serif;
          font-size: 14px;
         }
       .grey-shade {
         color: #888888;
       }
     </style>
   </head>
      <body style="margin: 0;width:100%;height: 100%">
       <table id="dataTable">
       <tr>
         <th>Customer Details</th>
       </tr>
     </table>
      
      <script>
        var Interaction;
        var _onMessage = function(oEvent) {
           if (oEvent.data.type === "response" && oEvent.data.payload.result !== "error") {
           	var data = oEvent.data.payload.value;
            	if (data.originator)
                  alert(JSON.stringify(data.attached_data))
                 parseAndPopulateTable(data.attached_data);
               Interaction = data;
            	}
        }
        window.addEventListener("message", _onMessage);
        window.parent.postMessage({type: "init", payload: false, id: "fn-1"}, "*");
      </script>

      <script>
        
          function createTableRow(key, value) {
            const tr = document.createElement("tr");
            const td = document.createElement("td");
            td.innerHTML = `<span class="grey-shade">${key}</span><br>${value}`;
            tr.appendChild(td);
            return tr;
          }
      
          function parseAndPopulateTable(contatData) {
            const table = document.getElementById("dataTable");
            const sapData = JSON.parse(contatData.EmarsysContactData);
      
            // Loop through the parsed data and create table rows
            for (const key in sapData) {
              if (sapData.hasOwnProperty(key)) {
                const value = sapData[key];
                const row = createTableRow(key, value);
                table.appendChild(row);
              }
            }
          }
     </script>

         
   </body>
</html>
