
<!DOCTYPE html>
<html lang="en" style="width:100%;height: 100%;">
<head>
                <meta charset=" UTF-8">
                <title>3rd Party extension testing</title>
</head>
<body style="margin: 0;width:100%;height: 100%">

<script>
			// Variables:
			var sInitRequest = "initRequest";
			var sUserDetailRequest = "userDetails";
			var oUser = null;
			var oInteraction = null;
			var sExtensionName = "TestExtension";
			
			var _log = function (sMsg) {
				console.log(sExtensionName + ":: " + sMsg);
			};
			
			// Window message handler:
			var _onMessage = function(oEvent) {
			
				switch(oEvent.data.type) {
					case "response":
						// CP responded to init command. For Extension Area, this message contains interaction:
						if (oEvent.data.id === sInitRequest) {
							
							// Cache interaction:
							oInteraction = oEvent.data.payload.value; // Cache interaction.
							// Request user details:
							window.parent.postMessage({type: "action", payload: {command:"detail",value:"user"}, id: sUserDetailRequest}, "*");							
						}
						
						// CP responded to user details request:
						else if (oEvent.data.id === sUserDetailRequest) {
							oUser = oEvent.data.payload.value; // Cache user.
						}
						
						// Once initial interaction data + current user data are in cache, react:
						if (oInteraction && oUser) {
							var sMessage = "User ["+oUser.username+"] is handling interaction ["+oInteraction.id+"]";
							_log(sMessage);
							alert(sMessage);
							// Here we would now do something, as we have interaction and user details.
						}
						break;
						
						
					case "state": // CP is sending a state update for an interaction.
						_log("Interaction ["+oInteraction.id+"] updated, attribute ["+oEvent.data.payload.attribute+"] changed");
						oInteraction = oEvent.data.payload.interaction; // Store updated interaction in cache
						// Here we could react if something interesting changes within interaction model, such as new chat message arrived, or phone connected.					
						break;
			
				}
			}

			// Listen for messages from CP:
			window.addEventListener("message", _onMessage);
			
			// Send initialization command:
			window.parent.postMessage({type: "init", payload: false, id: sInitRequest}, "*");
			
</script>

</body>
</html>
